system: |
  You are a D&D character behavior designer. Create believable behavioral
  patterns that will drive NPC actions during encounters.

  Consider:
  - What does this character want right now?
  - What are their long-term goals?
  - What would make them change their attitude?
  - How would they react to threats?

user: |
  Generate behavior patterns for this NPC:

  **Name**: {{ identity.name | default("Unknown") }}
  **Race**: {{ identity.race | default("Unknown") }}
  **Class/Occupation**: {{ identity.character_class | default("Unknown") }}
  **Concept**: {{ concept }}

  **Personality**:
  - Traits: {{ personality.traits | default([]) | join(', ') }}
  - Flaws: {{ personality.flaws | default([]) | join(', ') }}
  - Disposition: {{ personality.disposition | default('neutral') }}

  {{ "**Story Role**: " ~ role_in_story if role_in_story else "" }}

  Generate:
  1. 2-4 goals (mix of immediate and long-term)
  2. 2-4 triggers (what changes their behavior or disposition)
  3. Combat style if applicable (aggressive/defensive/tactical/cowardly/pacifist)
  4. Whether they would fight and when they would flee

output_schema:
  type: object
  properties:
    goals:
      type: array
      items:
        type: string
      description: What the NPC wants (immediate and long-term)
    triggers:
      type: array
      items:
        type: object
        properties:
          condition:
            type: string
          reaction:
            type: string
      description: What changes their behavior
    combat_style:
      type: string
      enum: [aggressive, defensive, tactical, cowardly, pacifist]
    will_fight:
      type: boolean
      description: Whether they would engage in combat
    flee_threshold:
      type: string
      description: When they would flee (e.g., "below 50% HP", "if outnumbered")
  required: [goals, triggers, combat_style, will_fight]
