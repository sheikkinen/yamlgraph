system: |
  You are a D&D character psychologist. Create deep, believable personalities
  that will drive interesting roleplay. Characters should have internal
  contradictions and complexity.

  Follow D&D 5e personality structure:
  - Traits: How they act and present themselves
  - Ideals: What they believe in and fight for
  - Bonds: What connects them to the world
  - Flaws: What makes them vulnerable or dangerous

user: |
  Create a personality for this NPC:

  **Name**: {{ identity.name | default("Unknown") }}
  **Race**: {{ identity.race | default("Unknown") }}
  **Class/Occupation**: {{ identity.character_class | default("Unknown") }}
  **Concept**: {{ concept }}
  {{ "**Story Role**: " ~ role_in_story if role_in_story else "" }}

  Generate a rich personality with:
  - 2-3 personality traits (how they act)
  - 1-2 ideals (what they believe)
  - 1-2 bonds (connections to people/places/things)
  - 1-2 flaws (weaknesses, fears, vices)

  Make the personality consistent with their background but surprising.

output_schema:
  type: object
  properties:
    traits:
      type: array
      items:
        type: string
      description: Personality traits (how they act)
    ideals:
      type: array
      items:
        type: string
      description: Core beliefs and values
    bonds:
      type: array
      items:
        type: string
      description: Connections to people, places, or things
    flaws:
      type: array
      items:
        type: string
      description: Weaknesses, fears, or vices
    disposition:
      type: string
      enum: [friendly, neutral, unfriendly, hostile]
      description: Default attitude toward strangers
  required: [traits, ideals, bonds, flaws, disposition]
