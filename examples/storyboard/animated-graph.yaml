version: "1.0"
name: animated-storyboard
description: Generate animated storyboard with first/middle/last frames per panel

# Declare input state fields
state:
  concept: str
  model: str
  story: any
  animated_panels: list

# Python tools for image generation
tools:
  generate_animated_images:
    type: python
    module: examples.storyboard.nodes.animated_image_node
    function: generate_animated_images_node
    description: Generate 3 images per panel (first, original, last frame)

nodes:
  # Step 1: Expand concept into story panels
  expand_story:
    type: llm
    prompt: examples/storyboard/expand_story
    state_key: story
    variables:
      concept: "{state.concept}"
      model: "{state.model}"

  # Step 2: Map each panel to animated frames (parallel)
  animate_panels:
    type: map
    over: "{state.story.panels}"
    as: panel_prompt
    node:
      type: llm
      prompt: examples/storyboard/animate_panel
      state_key: animated_panel
    collect: animated_panels

  # Step 3: Generate all images
  generate_images:
    type: python
    tool: generate_animated_images
    state_key: images
    requires: [animated_panels]

edges:
  - from: START
    to: expand_story
  - from: expand_story
    to: animate_panels
  - from: animate_panels
    to: generate_images
  - from: generate_images
    to: END
