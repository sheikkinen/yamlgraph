# RAG Pipeline Example
# Retrieves relevant documents and generates an answer

name: rag-example
description: Retrieval-Augmented Generation pipeline

defaults:
  prompts_relative: true

state:
  question: str
  rag_collection: str
  rag_query: str
  rag_db_path: str
  context: list
  answer: str

tools:
  rag_retrieve:
    type: python
    module: yamlgraph.tools.rag_retrieve
    function: rag_retrieve_node

nodes:
  setup:
    type: passthrough
    output:
      rag_collection: test_docs
      rag_query: "{state.question}"
      rag_db_path: examples/rag/vectorstore

  retrieve:
    type: python
    tool: rag_retrieve
    state_key: context

  answer:
    prompt: prompts/answer
    variables:
      context: "{state.context}"
      question: "{state.question}"

edges:
  - from: START
    to: setup
  - from: setup
    to: retrieve
  - from: retrieve
    to: answer
  - from: answer
    to: END
