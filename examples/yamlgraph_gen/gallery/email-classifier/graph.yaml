version: "1.0"
name: email-classifier
description: Classify emails by urgency and route to handlers

defaults:
  provider: anthropic
  model: claude-sonnet-4-20250514
  prompts_dir: prompts
  prompts_relative: true

state:
  email: str
  urgency: str
  response: str
  formatted_response: str

nodes:
  classify_email:
    type: router
    prompt: classify_email
    state_key: classification
    routes:
      urgent: urgent_handler
      normal: normal_handler
      low: low_priority_handler
    default_route: normal_handler

  urgent_handler:
    type: llm
    prompt: urgent_handler
    state_key: response
    variables:
      email: "{state.email}"

  normal_handler:
    type: llm
    prompt: normal_handler
    state_key: response
    variables:
      email: "{state.email}"

  low_priority_handler:
    type: llm
    prompt: low_priority_handler
    state_key: response
    variables:
      email: "{state.email}"

  format_response:
    type: llm
    prompt: format_response
    state_key: formatted_response
    variables:
      email: "{state.email}"
      response: "{state.response}"

edges:
  - from: START
    to: classify_email

  - from: classify_email
    to: [urgent_handler, normal_handler, low_priority_handler]
    type: conditional

  - from: urgent_handler
    to: format_response

  - from: normal_handler
    to: format_response

  - from: low_priority_handler
    to: format_response

  - from: format_response
    to: END
