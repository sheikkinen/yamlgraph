# Map Then Summarize Pattern
# Parallel processing â†’ aggregation
#
# ASSEMBLY INSTRUCTIONS:
# - Map node has nested sub-node under `node:` key
# - Map node itself does NOT have a prompt field
# - Use `over`, `as`, `node`, `collect` fields (not input_key, sub_node)
# - Sub-node is where the prompt goes

description: Process items in parallel then aggregate results

nodes:
  process_items:
    type: map
    over: "{state.items}"
    as: item
    node:
      prompt: process_item
      state_key: processed
      variables:
        item: "{state.item}"
    collect: processed_items

  summarize:
    type: llm
    prompt: summarize
    state_key: summary
    variables:
      items: "{state.processed_items}"

edges:
  - from: START
    to: process_items
  - from: process_items
    to: summarize
  - from: summarize
    to: END
