# Generate Then Map Pattern
# LLM generates list â†’ map processes each
#
# ASSEMBLY INSTRUCTIONS:
# - Map node has nested sub-node under `node:` key
# - Map node itself does NOT have a prompt field
# - Use `over`, `as`, `node`, `collect` fields (not input_key, sub_node)
# - Sub-node is where the prompt goes

description: Generate a list then process each item

nodes:
  generate_list:
    type: llm
    prompt: generate_list
    state_key: items
    variables:
      input: "{state.input}"

  process_items:
    type: map
    over: "{state.items}"
    as: item
    node:
      prompt: process_item
      state_key: result
      variables:
        item: "{state.item}"
    collect: results

edges:
  - from: START
    to: generate_list
  - from: generate_list
    to: process_items
  - from: process_items
    to: END
